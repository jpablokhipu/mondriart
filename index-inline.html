<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Mondriart - Prompt Artist Inline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            background: #F9F8F4;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #2c2c2c;
        }

        .container {
            width: 100%;
            max-width: 900px;
            text-align: left;
            display: flex;
            flex-direction: column;
            min-height: 60vh;
        }

        .static-question {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 40px;
            color: #2c2c2c;
            letter-spacing: -0.02em;
        }

        .accumulated-text {
            font-size: 1.3em; /* M√°s peque√±o cuando est√° resuelto */
            line-height: 1.6;
            margin-bottom: 20px;
            word-wrap: break-word;
            color: #4a4a4a;
        }

        .accumulated-text div {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .input-line {
            font-size: 1.8em; /* M√°s grande mientras se escribe */
            line-height: 1.6;
            margin-bottom: 30px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
            transition: font-size 0.3s ease;
            flex-wrap: wrap;
        }

        .step-tag {
            font-size: 0.4em;
            padding: 4px 12px;
            border: 1.5px solid #2c2c2c;
            border-radius: 20px;
            color: #2c2c2c;
            font-weight: 500;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .step-tag.completed {
            background: transparent;
            border-color: #2D7A4F;
            color: #2D7A4F;
        }

        .input-prefix {
            color: #2c2c2c;
            font-size: 0.9em;
            margin-top: 12px;
            line-height: 1.4;
            display: flex;
            align-items: flex-start;
        }

        .input-examples {
            font-size: 1.1em;
            color: #cccccc;
            margin-top: 25px;
            font-style: italic;
            line-height: 1.3;
            text-align: center;
        }

        .lightbulb-icon {
            font-style: normal;
        }

        .enter-icon {
            opacity: 0;
            transition: opacity 0.3s ease;
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaaaaa;
            font-size: 0.6em;
            display: flex;
            align-items: center;
            pointer-events: none;
        }

        .enter-icon.visible {
            opacity: 1;
        }

        .enter-arrow {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #aaaaaa;
            border-radius: 4px;
            position: relative;
        }

        .enter-arrow::before {
            content: '‚Üµ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: #aaaaaa;
        }

        .user-input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: #2c2c2c;
            font-family: inherit;
            font-size: 0.8em;
            min-width: 20px;
            border-bottom: 2px solid #cccccc;
            padding: 5px 5px 0px 5px;
            padding-right: 35px; /* Espacio para el icono */
            caret-color: #2c2c2c;
            word-break: break-word;
            overflow-wrap: break-word;
            resize: none;
            overflow: hidden;
            line-height: 1.4;
            min-height: 1.4em;
            vertical-align: baseline;
            margin-top: 7px;
        }

        .user-input::placeholder {
            color: #aaaaaa;
            font-size: 0.8em; /* Mismo tama√±o que el texto ingresado */
        }

        .input-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
            display: flex;
            align-items: flex-start;
        }

        /* Permitir que el input ocupe toda la l√≠nea si el contenido es muy largo */
        @media (max-width: 768px) {
            .input-wrapper {
                flex-basis: 100%;
            }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .suggestions-container {
            margin-top: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            display: none; /* Desactivado temporalmente */
        }

        .suggestion-item {
            background: #f5f5f5;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            color: #4a4a4a;
        }

        .suggestion-item:hover,
        .suggestion-item.selected {
            background: #e8e8e8;
            border-color: #333333;
            transform: translateX(10px);
        }

        .suggestion-item-match {
            font-weight: bold;
            color: #000000;
        }

        .result-container {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
            text-align: left;
            border: 2px solid #e0e0e0;
        }

        .result-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2c2c2c;
        }

        .result-prompt {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 25px;
            padding: 20px;
            background: #ffffff;
            border-radius: 8px;
            color: #2c2c2c;
            border: 1px solid #d0d0d0;
        }

        .button {
            background: #ffffff;
            border: 2px solid #333333;
            color: #333333;
            padding: 12px 30px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .button:hover {
            background: #333333;
            color: #ffffff;
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .prompt-line {
                font-size: 1.5em;
            }

            .suggestion-item {
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .prompt-line {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pregunta est√°tica -->
        <div class="static-question">¬øQu√© imagen quieres crear?</div>

        <!-- Texto acumulado -->
        <div class="accumulated-text" id="accumulatedText"></div>

        <!-- L√≠nea de input actual -->
        <div class="input-line" id="inputLine">
            <span class="step-tag" id="stepTag">SUJETO</span>
            <span class="input-prefix">Una imagen de</span>
            <div class="input-wrapper">
                <textarea class="user-input" id="userInput" autocomplete="off" spellcheck="false" placeholder="" rows="1"></textarea>
                <div class="enter-icon" id="enterIcon">
                    <span class="enter-arrow"></span>
                </div>
            </div>
        </div>

        <!-- Ejemplos centralizados -->
        <div class="input-examples" id="inputExamples">
            <span class="lightbulb-icon">üí°</span> una bailarina de ballet; un paisaje urbano; o un auto futurista...
        </div>

        <div class="suggestions-container" id="suggestionsContainer">
            <!-- Sugerencias se insertan aqu√≠ -->
        </div>


        <div class="result-container hidden" id="resultContainer">
            <div class="result-title">‚ú® Tu Prompt Generado</div>
            <div class="result-prompt" id="resultPrompt"></div>
            <button class="button" onclick="copyToClipboard()">üìã Copiar Prompt</button>
            <button class="button" onclick="restart()">üîÑ Crear Nuevo</button>
        </div>
    </div>

    <script>
        // Estado global
        let accumulatedContent = [];
        let selectedSuggestionIndex = -1;
        let currentSuggestions = [];
        let wordCount = 0;
        let currentStep = 0;
        let subjectCategory = 'general'; // persona, paisaje, objeto, o general

        // Configuraci√≥n de pasos del di√°logo con ejemplos contextuales
        const dialogSteps = [
            {
                tag: 'Sujeto',
                prefix: 'Una imagen de',
                placeholder: '',
                examples: '<span class="lightbulb-icon">üí°</span> una bailarina de ballet; un paisaje urbano; o un auto futurista...'
            },
            {
                tag: 'Acci√≥n',
                prefix: 'Observamos que est√°',
                placeholder: '',
                examples: {
                    persona: '<span class="lightbulb-icon">üí°</span> sonriendo sutilmente; o disfrutando un caf√©...',
                    paisaje: '<span class="lightbulb-icon">üí°</span> en un d√≠a soleado de verano; o cubierto de neblina matinal...',
                    objeto: '<span class="lightbulb-icon">üí°</span> sobre un mostrador; o suspendido en el aire...',
                    general: '<span class="lightbulb-icon">üí°</span> emitiendo luces brillantes; o levitando sobre el suelo...'
                }
            },
            {
                tag: 'Entorno',
                prefix: 'Todo ocurre en',
                placeholder: '',
                examples: {
                    persona: '<span class="lightbulb-icon">üí°</span> una terraza al aire libre; o una c√≥moda sala de estar...',
                    paisaje: '<span class="lightbulb-icon">üí°</span> un entorno rodeado de naturaleza; o un entorno muy urbanizado...',
                    objeto: '<span class="lightbulb-icon">üí°</span> un fondo oscuro elegante; o una mesa de madera...',
                    general: '<span class="lightbulb-icon">üí°</span> un espacio infinito; o en una dimensi√≥n paralela...'
                }
            },
            {
                tag: 'Estilo',
                prefix: 'Le dar√© un estilo de',
                placeholder: '',
                examples: '<span class="lightbulb-icon">üí°</span> fotograf√≠a profesional; o ilustraci√≥n digital colorida...'
            },
            {
                tag: 'Iluminaci√≥n',
                prefix: 'y una iluminaci√≥n',
                placeholder: '',
                examples: '<span class="lightbulb-icon">üí°</span> natural con suaves sombras; dorada al atardecer; o profesional de estudio...'
            },
            {
                tag: 'Detalles',
                prefix: 'Destacar√© como detalles',
                placeholder: '',
                examples: {
                    persona: '<span class="lightbulb-icon">üí°</span> cabello suelto y natural; o expresi√≥n serena y confiada...',
                    paisaje: '<span class="lightbulb-icon">üí°</span> una paleta de colores c√°lidos; o colores saturados y vibrantes...',
                    objeto: '<span class="lightbulb-icon">üí°</span> acabados met√°licos brillantes; o superficies mate elegantes...',
                    general: '<span class="lightbulb-icon">üí°</span> elementos decorativos en segundo plano; o texturas geom√©tricas...'
                }
            }
        ];

        // Banco de sugerencias - todas mezcladas para detecci√≥n inteligente
        const allSuggestions = [
            // Sujetos
            'una bailarina de ballet cl√°sico',
            'una mujer joven en sus 20s',
            'un hombre de negocios ejecutivo',
            'una chef profesional',
            'un m√∫sico tocando guitarra',
            'una atleta corriendo',
            'un ni√±o jugando',
            'una modelo posando',
            'un artista pintando',
            'una anciana sonriendo',
            // Acciones
            'saltando en el aire con gracia',
            'posando elegantemente',
            'caminando con confianza',
            'mirando hacia la c√°mara',
            'en movimiento din√°mico',
            'ejecutando una pirueta',
            'sonriendo naturalmente',
            'concentrado en su trabajo',
            // Entornos
            'en un estudio fotogr√°fico amplio',
            'en un espacio urbano moderno',
            'en un ambiente natural abierto',
            'en una calle transitada',
            'en un escenario teatral',
            'en un espacio minimalista',
            'en un parque al aire libre',
            'en una habitaci√≥n elegante',
            // Estilos
            'fotograf√≠a profesional con luz natural',
            'ilustraci√≥n digital colorida',
            'render 3D hiperrealista',
            'fotograf√≠a cinematogr√°fica',
            'estilo acuarela suave',
            'fotograf√≠a de retrato',
            'ilustraci√≥n vectorial moderna',
            'estilo minimalista contempor√°neo',
            // Detalles
            'con cabello recogido elegante',
            'vistiendo ropa deportiva',
            'con expresi√≥n serena',
            'usando accesorios llamativos',
            'con maquillaje natural',
            'en vestimenta formal',
            'con gestos expresivos',
            'con mirada penetrante',
            'en pose din√°mica'
        ];

        // Referencias DOM
        const accumulatedText = document.getElementById('accumulatedText');
        const userInput = document.getElementById('userInput');
        const inputPrefix = document.querySelector('.input-prefix');
        const stepTag = document.getElementById('stepTag');
        const inputExamples = document.getElementById('inputExamples');
        const enterIcon = document.getElementById('enterIcon');
        const suggestionsContainer = document.getElementById('suggestionsContainer');
        const resultContainer = document.getElementById('resultContainer');
        const resultPrompt = document.getElementById('resultPrompt');

        // Control de typing timeout
        let typingTimer;
        const typingDelay = 800; // ms despu√©s de parar de escribir

        // Inicializaci√≥n
        window.addEventListener('load', () => {
            updateInputForStep();
            userInput.focus();
        });

        // Actualizar input seg√∫n el paso actual
        function updateInputForStep() {
            const step = dialogSteps[currentStep];
            if (step) {
                stepTag.textContent = step.tag.toUpperCase();
                inputPrefix.textContent = step.prefix;
                userInput.placeholder = step.placeholder;

                // Mostrar ejemplos contextuales seg√∫n la categor√≠a detectada
                if (typeof step.examples === 'object') {
                    inputExamples.innerHTML = step.examples[subjectCategory] || step.examples.general;
                } else {
                    inputExamples.innerHTML = step.examples;
                }
            }
        }

        // Auto-expandir textarea mientras el usuario escribe
        function autoExpandTextarea() {
            userInput.style.height = 'auto';
            userInput.style.height = userInput.scrollHeight + 'px';
        }

        // Detectar categor√≠a del sujeto
        function detectSubjectCategory(sujetoText) {
            const texto = sujetoText.toLowerCase();

            // Detectar persona/personaje
            const personaKeywords = ['persona', 'mujer', 'hombre', 'ni√±o', 'ni√±a', 'bailarina', 'bailar√≠n',
                                     'modelo', 'artista', 'atleta', 'profesional', 'anciano', 'anciana',
                                     'joven', 'chef', 'm√∫sico', 'actor', 'actriz', 'retrato', 'humano'];
            if (personaKeywords.some(kw => texto.includes(kw))) {
                return 'persona';
            }

            // Detectar paisaje/escena
            const paisajeKeywords = ['paisaje', 'ciudad', 'urbano', 'playa', 'monta√±a', 'bosque',
                                     'calle', 'parque', 'jard√≠n', 'valle', 'desierto', 'oc√©ano',
                                     'atardecer', 'amanecer', 'naturaleza', 'escena', 'horizonte',
                                     'cielo', 'mar', 'r√≠o', 'lago', 'costa'];
            if (paisajeKeywords.some(kw => texto.includes(kw))) {
                return 'paisaje';
            }

            // Detectar objeto/producto
            const objetoKeywords = ['coche', 'auto', 'reloj', 'producto', 'objeto', 'tel√©fono',
                                   'zapato', 'botella', 'comida', 'plato', 'joya', 'mueble',
                                   'dispositivo', 'instrumento', 'herramienta', 'veh√≠culo',
                                   'm√°quina', 'edificio', 'estructura'];
            if (objetoKeywords.some(kw => texto.includes(kw))) {
                return 'objeto';
            }

            return 'general';
        }

        // Filtrar sugerencias basado en texto actual
        function filterSuggestions(query) {
            if (!query || query.length < 2) {
                return [];
            }

            // Obtener √∫ltimas palabras escritas para contexto
            const words = query.trim().split(/\s+/);
            const lastWords = words.slice(-3).join(' ').toLowerCase();

            const filtered = allSuggestions.filter(suggestion =>
                suggestion.toLowerCase().includes(lastWords) ||
                lastWords.split(/\s+/).some(word => suggestion.toLowerCase().includes(word))
            );

            filtered.sort((a, b) => {
                const aStartsWith = a.toLowerCase().startsWith(lastWords);
                const bStartsWith = b.toLowerCase().startsWith(lastWords);
                if (aStartsWith && !bStartsWith) return -1;
                if (!aStartsWith && bStartsWith) return 1;
                return 0;
            });

            return filtered.slice(0, 6);
        }

        // Highlight de coincidencias
        function highlightMatch(text, query) {
            if (!query) return text;

            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();
            const index = lowerText.indexOf(lowerQuery);

            if (index === -1) return text;

            const before = text.substring(0, index);
            const match = text.substring(index, index + query.length);
            const after = text.substring(index + query.length);

            return `${before}<span class="suggestion-item-match">${match}</span>${after}`;
        }

        // Renderizar sugerencias
        function renderSuggestions(suggestions, query) {
            suggestionsContainer.innerHTML = '';

            if (suggestions.length === 0) {
                return;
            }

            suggestions.forEach((suggestion, index) => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                if (index === selectedSuggestionIndex) {
                    item.classList.add('selected');
                }

                item.innerHTML = highlightMatch(suggestion, query);

                item.addEventListener('click', () => {
                    selectSuggestion(suggestion);
                });

                suggestionsContainer.appendChild(item);
            });

            currentSuggestions = suggestions;
        }

        // Seleccionar sugerencia - la agrega al texto actual
        function selectSuggestion(suggestion) {
            const currentText = userInput.value.trim();

            // Si hay texto, agregar la sugerencia
            if (currentText) {
                userInput.value = currentText + ', ' + suggestion;
            } else {
                userInput.value = suggestion;
            }

            suggestionsContainer.innerHTML = '';
            selectedSuggestionIndex = -1;
            currentSuggestions = [];
            userInput.focus();
            updateWordCount();
        }

        // Actualizar contador de palabras
        function updateWordCount() {
            const text = (accumulatedContent.join(' ') + ' ' + userInput.value).trim();
            wordCount = text.split(/\s+/).filter(w => w.length > 0).length;
        }

        // Agregar fragmento al texto acumulado (presionando Enter)
        function addFragment() {
            const text = userInput.value.trim();
            if (!text || text.length < 2) return;

            // Animar la reducci√≥n: hacer que la l√≠nea actual se encoja antes de moverse
            const inputLine = document.getElementById('inputLine');
            inputLine.style.fontSize = '1.3em';

            setTimeout(() => {
                // Construir l√≠nea completa con tag y prefix
                const currentTag = dialogSteps[currentStep].tag.toUpperCase();
                const currentPrefix = dialogSteps[currentStep].prefix;

                // Agregar punto final a todas las l√≠neas excepto "Estilo"
                const punctuation = currentTag === 'ESTILO' ? '' : '.';
                const fullLine = `<span class="step-tag completed">${currentTag}</span>${currentPrefix} ${text}${punctuation}`;

                // Agregar al contenido acumulado
                accumulatedContent.push(fullLine);

                // Detectar categor√≠a del sujeto en el primer paso
                if (currentStep === 0) {
                    subjectCategory = detectSubjectCategory(text);
                    console.log('Categor√≠a detectada:', subjectCategory);
                }

                // Actualizar visualizaci√≥n - cada l√≠nea en su propia l√≠nea
                const lines = accumulatedContent.map(line => `<div>${line}</div>`).join('');
                accumulatedText.innerHTML = lines;

                // Avanzar al siguiente paso
                currentStep++;

                // Si llegamos al final de los pasos, mostrar opciones
                if (currentStep >= dialogSteps.length) {
                    showFinalOptions();
                    return;
                }

                // Restaurar tama√±o grande para el siguiente input
                inputLine.style.fontSize = '1.8em';

                // Actualizar input para el nuevo paso
                updateInputForStep();

                // Limpiar input
                userInput.value = '';
                suggestionsContainer.innerHTML = '';
                selectedSuggestionIndex = -1;
                currentSuggestions = [];

                updateWordCount();
                userInput.focus();
            }, 300); // Dar tiempo para la animaci√≥n de reducci√≥n
        }

        // Mostrar opciones finales antes de generar
        function showFinalOptions() {
            const inputLine = document.getElementById('inputLine');
            inputLine.innerHTML = `
                <div style="display: flex; gap: 10px; width: 100%;">
                    <button class="button" onclick="generatePrompt()" style="flex: 1;">‚ú® Generar Prompt</button>
                    <button class="button" onclick="editPrompt()" style="flex: 1;">‚úèÔ∏è Editar</button>
                </div>
            `;

            // Ocultar los ejemplos cuando se muestran las opciones finales
            const inputExamples = document.getElementById('inputExamples');
            inputExamples.style.display = 'none';
        }

        // Permitir editar el √∫ltimo paso
        function editPrompt() {
            if (accumulatedContent.length === 0) return;

            // Volver un paso atr√°s
            currentStep--;

            // Remover la √∫ltima l√≠nea del contenido acumulado
            const lastLine = accumulatedContent.pop();

            // Actualizar visualizaci√≥n
            const lines = accumulatedContent.map(line => `<div>${line}</div>`).join('');
            accumulatedText.innerHTML = lines;

            // Restaurar el input line
            const inputLine = document.getElementById('inputLine');
            inputLine.innerHTML = `
                <span class="step-tag" id="stepTag">SUJETO</span>
                <span class="input-prefix">Una imagen de</span>
                <div class="input-wrapper">
                    <textarea class="user-input" id="userInput" autocomplete="off" spellcheck="false" placeholder="" rows="1"></textarea>
                    <div class="enter-icon" id="enterIcon">
                        <span class="enter-arrow"></span>
                    </div>
                </div>
            `;

            // Recuperar el texto del √∫ltimo paso (extraer solo el texto sin tags ni prefix)
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = lastLine;
            const textContent = tempDiv.textContent || tempDiv.innerText || '';
            const currentPrefix = dialogSteps[currentStep].prefix;
            const userText = textContent.replace(dialogSteps[currentStep].tag.toUpperCase(), '').replace(currentPrefix, '').trim();

            // Actualizar para el paso actual
            updateInputForStep();

            // Mostrar los ejemplos nuevamente
            const inputExamples = document.getElementById('inputExamples');
            inputExamples.style.display = 'block';

            // Restaurar referencias DOM
            const userInput = document.getElementById('userInput');
            const enterIcon = document.getElementById('enterIcon');

            // Precargar el texto anterior
            userInput.value = userText;

            // Auto-expandir el textarea con el texto precargado
            autoExpandTextarea();

            // Restaurar tama√±o
            inputLine.style.fontSize = '1.8em';

            // Re-aplicar event listeners
            reattachEventListeners();

            userInput.focus();
        }

        // Re-adjuntar event listeners despu√©s de editar
        function reattachEventListeners() {
            const userInput = document.getElementById('userInput');
            const enterIcon = document.getElementById('enterIcon');

            userInput.addEventListener('input', () => {
                autoExpandTextarea();
                updateWordCount();
                enterIcon.classList.remove('visible');
                clearTimeout(typingTimer);
                if (userInput.value.trim().length > 0) {
                    typingTimer = setTimeout(() => {
                        enterIcon.classList.add('visible');
                    }, typingDelay);
                }
            });

            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    generatePrompt();
                    return;
                }
                if (e.key === 'Enter') {
                    e.preventDefault();
                    enterIcon.classList.remove('visible');
                    addFragment();
                }
            });
        }

        // Generar prompt final
        function generatePrompt() {
            // Agregar texto actual si hay alguno
            const currentText = userInput.value.trim();
            if (currentText) {
                accumulatedContent.push(currentText);
            }

            if (accumulatedContent.length === 0) {
                alert('Escribe algo primero para generar el prompt');
                return;
            }

            // Ocultar interfaz de input
            document.getElementById('inputLine').style.display = 'none';
            suggestionsContainer.style.display = 'none';
            accumulatedText.style.display = 'none';

            // Construir prompt narrativo optimizado
            const fullText = accumulatedContent.join(', ');

            // Capitalizar primera letra
            const prompt = fullText.charAt(0).toUpperCase() + fullText.slice(1) + '.';

            // Mostrar resultado
            resultPrompt.textContent = prompt;
            resultContainer.classList.remove('hidden');
            window.generatedPrompt = prompt;
        }

        // Copiar al portapapeles
        function copyToClipboard() {
            if (window.generatedPrompt) {
                navigator.clipboard.writeText(window.generatedPrompt).then(() => {
                    alert('‚úÖ Prompt copiado al portapapeles');
                });
            }
        }

        // Reiniciar
        function restart() {
            accumulatedContent = [];
            selectedSuggestionIndex = -1;
            currentSuggestions = [];
            wordCount = 0;
            currentStep = 0;

            document.getElementById('inputLine').style.display = 'flex';
            suggestionsContainer.style.display = 'block';
            accumulatedText.style.display = 'block';
            resultContainer.classList.add('hidden');

            accumulatedText.innerHTML = '';
            userInput.value = '';
            suggestionsContainer.innerHTML = '';

            updateInputForStep();
            userInput.focus();
        }

        // Event listeners
        userInput.addEventListener('input', () => {
            autoExpandTextarea();
            updateWordCount();

            // Ocultar icono mientras escribe
            enterIcon.classList.remove('visible');

            // Resetear timer
            clearTimeout(typingTimer);

            // Si hay texto, mostrar icono despu√©s de parar de escribir
            if (userInput.value.trim().length > 0) {
                typingTimer = setTimeout(() => {
                    enterIcon.classList.add('visible');
                }, typingDelay);
            }
        });

        userInput.addEventListener('keydown', (e) => {
            // Ctrl+Enter para generar prompt (antes de completar los 5 pasos)
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                generatePrompt();
                return;
            }

            // Enter normal: agregar fragmento al texto acumulado y avanzar paso
            if (e.key === 'Enter') {
                e.preventDefault();
                enterIcon.classList.remove('visible'); // Ocultar icono al presionar Enter
                addFragment();
            }
        });

        // Mantener focus en el input
        document.addEventListener('click', () => {
            if (!resultContainer.classList.contains('hidden')) return;
            userInput.focus();
        });
    </script>
</body>
</html>
